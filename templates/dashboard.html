{% extends "base.html" %} {% block title %}Dashboard - Expense Tracker{% endblock %} {% block
navbar_right %}
<li class="nav-item">
    <a class="nav-link" href="/logout">Logout</a>
</li>
{% endblock %} {% block content %}
<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Welcome, <span id="username"></span>!</h5>
                <p class="card-text">Track your expenses and manage your budget effectively.</p>
                <a href="/expenses" class="btn btn-primary">Go to Expenses</a>
            </div>
        </div>
    </div>
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Expense Summary</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <h6 class="card-title">Total Expenses</h6>
                                <h3 class="card-text" id="totalExpenses">$0.00</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <h6 class="card-title">This Month</h6>
                                <h3 class="card-text" id="monthlyExpenses">$0.00</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-info text-white">
                            <div class="card-body">
                                <h6 class="card-title">Top Category</h6>
                                <h3 class="card-text" id="topCategory">-</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Recent Expenses</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="recentExpensesTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block extra_scripts %}
<script>
    $(document).ready(function () {
        // Load user data
        $.get("/api/expenses", function (expenses) {
            updateDashboard(expenses);
        });
    });

    function updateDashboard(expenses) {
        // Update username
        $("#username").text("{{ session.user.username }}");

        // Calculate totals
        let total = 0;
        let monthlyTotal = 0;
        const categories = {};
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();

        expenses.forEach((expense) => {
            total += expense.amount;
            const expenseDate = new Date(expense.date);
            if (
                expenseDate.getMonth() === currentMonth &&
                expenseDate.getFullYear() === currentYear
            ) {
                monthlyTotal += expense.amount;
            }
            categories[expense.category] = (categories[expense.category] || 0) + expense.amount;
        });

        // Update summary cards
        $("#totalExpenses").text("$" + total.toFixed(2));
        $("#monthlyExpenses").text("$" + monthlyTotal.toFixed(2));

        // Find top category
        let topCategory = "-";
        let maxAmount = 0;
        for (const [category, amount] of Object.entries(categories)) {
            if (amount > maxAmount) {
                maxAmount = amount;
                topCategory = category;
            }
        }
        $("#topCategory").text(topCategory);

        // Update recent expenses table
        const tbody = $("#recentExpensesTable");
        tbody.empty();

        // Sort expenses by date and take the 5 most recent
        const recentExpenses = expenses
            .sort((a, b) => new Date(b.date) - new Date(a.date))
            .slice(0, 5);

        recentExpenses.forEach((expense) => {
            const row = `
                <tr>
                    <td>${expense.date}</td>
                    <td>${expense.category}</td>
                    <td>${expense.description}</td>
                    <td>$${expense.amount.toFixed(2)}</td>
                </tr>
            `;
            tbody.append(row);
        });
    }
</script>
{% endblock %} {% block extra_head %}
<link rel="stylesheet" href="/static/css/dashboard.css" />
{% endblock %}
